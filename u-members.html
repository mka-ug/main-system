<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Umoomi Security · Members Registry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Segoe UI', Roboto, sans-serif;
  background: #f4f6f9;
  height: 100vh;
  overflow: hidden;
  padding: 20px;
}
.container {
  max-width: 1400px;
  margin: 0 auto;
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* HEADER - FROZEN - Umoomi design */
header {
  background: linear-gradient(145deg, #ffffff 0%, #f0f4f8 100%);
  padding: 20px 28px;
  border-radius: 28px;
  margin-bottom: 24px;
  display: flex;
  gap: 18px;
  align-items: center;
  box-shadow: 0 8px 18px rgba(0,20,30,0.06);
  flex-shrink: 0;
}
header i {
  font-size: 3rem;
  color: #1e3c5c;
  filter: drop-shadow(0 2px 4px rgba(0,60,120,0.2));
}
header h2 {
  font-weight: 600;
  color: #0b2a41;
  letter-spacing: -0.02em;
}
header small {
  color: #3a5e7a;
  font-size: 0.9rem;
}

/* LAYOUT - FROZEN SIDEBAR */
.layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 24px;
  height: calc(100vh - 140px);
  overflow: hidden;
}

/* SIDEBAR - FROZEN - Umoomi design */
aside {
  background: #ffffff;
  border-radius: 28px;
  padding: 16px 10px;
  box-shadow: 0 12px 28px rgba(0,20,40,0.06);
  backdrop-filter: blur(2px);
  height: fit-content;
  max-height: calc(100vh - 140px);
  overflow-y: auto;
  position: sticky;
  top: 0;
  flex-shrink: 0;
}
aside a {
  display: flex;
  align-items: center;
  gap: 14px;
  text-decoration: none;
  padding: 12px 18px;
  border-radius: 18px;
  color: #1e3b5c;
  font-weight: 500;
  margin-bottom: 6px;
  transition: all 0.15s ease;
  cursor: pointer;
}
aside a i { width: 22px; font-size: 1.2rem; }
aside a:hover, aside a.active {
  background: #1d4d7c;
  color: #ffffff;
  box-shadow: 0 6px 14px rgba(27,85,140,0.3);
}
aside a.active { background: #113753; }

/* MAIN PANEL - SCROLLABLE */
main {
  background: #ffffff;
  border-radius: 32px;
  padding: 24px 28px;
  box-shadow: 0 16px 30px rgba(0,10,30,0.04);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

/* Quick stats cards - ABOVE content */
.quick-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px;
  margin-bottom: 24px;
  flex-shrink: 0;
}
.stat-card {
  background: linear-gradient(145deg, #1e3f5f, #2c5a85);
  color: white;
  padding: 20px 14px;
  border-radius: 26px;
  text-align: center;
  box-shadow: 0 16px 28px -8px #1d3f5e60;
}
.stat-card i {
  font-size: 2rem;
  opacity: 0.95;
  margin-bottom: 8px;
}
.stat-card .stat-number {
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: 1px;
  line-height: 1.2;
}
.stat-card .stat-label {
  font-size: 0.9rem;
  opacity: 0.9;
}

/* Search bar - Umoomi style */
.search {
  margin-bottom: 20px;
  flex-shrink: 0;
}
.search input {
  width: 100%;
  padding: 14px 20px;
  border: 1px solid #c4d7ec;
  border-radius: 40px;
  font-size: 1rem;
  background: #f4faff;
  outline: none;
  transition: all 0.15s ease;
}
.search input:focus {
  border-color: #1d4d7c;
  box-shadow: 0 0 0 3px rgba(29, 77, 124, 0.1);
}
.search i {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: #1e3f5f;
}

/* Table container */
.table-container {
  background: #f8faff;
  border-radius: 24px;
  padding: 4px;
  flex: 1;
  overflow: auto;
  margin-bottom: 10px;
}

/* Table styling - Enhanced */
table {
  width: 100%;
  border-collapse: collapse;
  border-radius: 20px;
  overflow: hidden;
}
th {
  background: #1d4d7c;
  color: white;
  font-weight: 600;
  text-align: left;
  padding: 16px 20px;
  font-size: 0.95rem;
  position: sticky;
  top: 0;
  z-index: 10;
}
td {
  padding: 14px 20px;
  border-bottom: 1px solid rgba(148, 184, 218, 0.2);
  background: white;
}
tr:hover td {
  background: #f0f7ff;
  cursor: pointer;
}
tr:last-child td {
  border-bottom: none;
}

/* Badge styling */
.badge {
  padding: 6px 14px;
  border-radius: 40px;
  font-size: 0.8rem;
  font-weight: 600;
  color: #fff;
  display: inline-block;
}
.badge.active {
  background: #2e7d32;
  background: linear-gradient(145deg, #2e7d32, #1e5f22);
}
.badge.suspended {
  background: #c62828;
  background: linear-gradient(145deg, #c62828, #9e1f1f);
}
.badge.inactive {
  background: #616161;
  background: linear-gradient(145deg, #616161, #424242);
}

/* MODAL - Umoomi design */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(8, 25, 45, 0.5);
  backdrop-filter: blur(3px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
  padding: 20px;
}

/* PROFILE BOX - Enhanced */
.profile-box {
  background: #ffffff;
  width: 900px;
  max-height: 90vh;
  overflow-y: auto;
  border-radius: 42px;
  box-shadow: 0 40px 60px rgba(0,15,40,0.4);
  border: 1px solid #b9d4f0;
  position: relative;
  animation: slideUp 0.3s ease;
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* CLOSE BUTTON */
.close-btn {
  position: absolute;
  top: 20px;
  right: 25px;
  width: 40px;
  height: 40px;
  background: #f4faff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #1e3f5f;
  cursor: pointer;
  z-index: 20;
  transition: all 0.15s ease;
  font-size: 1.2rem;
}
.close-btn:hover {
  background: #fdecea;
  color: #c63737;
  transform: rotate(90deg);
}

.profile-header {
  background: linear-gradient(145deg, #1e3f5f, #2c5a85);
  color: #fff;
  padding: 20px 25px;
  border-radius: 42px 42px 0 0;
  text-align: center;
}
.profile-header h2 {
  font-size: 1.6rem;
  letter-spacing: 1px;
  font-weight: 600;
}

.profile-body {
  padding: 30px;
}

.profile-top {
  display: grid;
  grid-template-columns: 180px 1fr;
  gap: 30px;
  margin-bottom: 25px;
  background: #f8faff;
  padding: 20px;
  border-radius: 24px;
  border: 1px solid rgba(148, 184, 218, 0.2);
}

.profile-photo {
  width: 160px;
  height: 180px;
  border: 2px solid #c4d7ec;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f4faff;
  overflow: hidden;
}
.profile-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.profile-photo i {
  color: #1e3f5f;
  opacity: 0.5;
}

.profile-summary h3 {
  margin-bottom: 15px;
  font-size: 1.4rem;
  color: #1e3f5f;
  font-weight: 600;
}
.summary-row {
  margin-bottom: 10px;
  padding: 8px 12px;
  background: white;
  border-radius: 40px;
  border: 1px solid #e0e9f0;
}
.summary-row strong {
  color: #1d4d7c;
  width: 100px;
  display: inline-block;
}

.section-title {
  margin: 30px 0 15px;
  padding-bottom: 8px;
  border-bottom: 2px solid #1d4d7c;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 1rem;
  color: #1e3f5f;
  letter-spacing: 1px;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1px;
  background: #e0e9f0;
  border: 1px solid #e0e9f0;
  border-radius: 16px;
  overflow: hidden;
}
.info-item {
  background: white;
  padding: 12px 15px;
  font-size: 0.95rem;
}
.info-item strong {
  display: block;
  font-size: 0.75rem;
  color: #7f8c8d;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.assistants-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-top: 15px;
}
.assistant-card {
  background: linear-gradient(145deg, #f8faff, #f0f4fa);
  border: 1px solid rgba(148, 184, 218, 0.2);
  border-radius: 24px;
  padding: 20px;
  text-align: center;
  transition: all 0.15s ease;
}
.assistant-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 22px rgba(0,30,60,0.12);
}
.assistant-card img {
  width: 90px;
  height: 90px;
  object-fit: cover;
  border: 2px solid #c4d7ec;
  border-radius: 50%;
  margin-bottom: 12px;
}
.assistant-card i {
  color: #1e3f5f;
  opacity: 0.5;
  margin-bottom: 10px;
}
.assistant-card strong {
  color: #1e3f5f;
  font-size: 1.1rem;
  display: block;
  margin-bottom: 5px;
}
.assistant-card div:last-child {
  color: #3a5e7a;
  font-size: 0.9rem;
}

/* Custom scrollbar */
main::-webkit-scrollbar,
aside::-webkit-scrollbar,
.profile-box::-webkit-scrollbar {
  width: 6px;
}
main::-webkit-scrollbar-track,
aside::-webkit-scrollbar-track,
.profile-box::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}
main::-webkit-scrollbar-thumb,
aside::-webkit-scrollbar-thumb,
.profile-box::-webkit-scrollbar-thumb {
  background: #1e3f5f;
  border-radius: 10px;
}
main::-webkit-scrollbar-thumb:hover,
aside::-webkit-scrollbar-thumb:hover,
.profile-box::-webkit-scrollbar-thumb:hover {
  background: #2c5a85;
}
</style>
</head>
<body>

<div class="container">
  <!-- HEADER - FROZEN - Umoomi design -->
  <header>
    <i class="fas fa-shield-halved"></i>
    <div>
      <h2>Umoomi Security · Members Registry</h2>
      <small>Ahmadiyya Muslim Community Uganda · official member database</small>
    </div>
  </header>

  <div class="layout">
    <!-- SIDEBAR - FROZEN - Umoomi design -->
    <aside>
      <a href="department_bb485cd8-db88-46dc-b9c5-e196fa963f5e.html"><i class="fas fa-chart-pie"></i> Dashboard</a>
      <a href="u-members.html" class="active"><i class="fas fa-people-group"></i> Members</a>
      <a href="u-scanner.html"><i class="fas fa-qrcode"></i> Scan ID</a>
      <a href="u-regions.html"><i class="fas fa-map-locations"></i> Regions</a>
      <a href="u-scan-logs.html"><i class="fas fa-clock-rotate-left"></i> Activity Logs</a>
      <a href="u-settings.html"><i class="fas fa-gear"></i> Settings</a>
    </aside>

    <!-- MAIN PANEL - SCROLLABLE -->
    <main>
      <!-- Quick stats cards - ABOVE content (will be populated by JS) -->
      <div class="quick-stats" id="quickStats">
        <div class="stat-card">
          <i class="fas fa-users"></i>
          <div class="stat-number" id="statTotal">0</div>
          <div class="stat-label">Total Members</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-user-check"></i>
          <div class="stat-number" id="statActive">0</div>
          <div class="stat-label">Active</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-user-clock"></i>
          <div class="stat-number" id="statSuspended">0</div>
          <div class="stat-label">Suspended</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-user-minus"></i>
          <div class="stat-number" id="statInactive">0</div>
          <div class="stat-label">Inactive</div>
        </div>
      </div>

      <!-- Search bar -->
      <div class="search">
        <input id="search" type="text" placeholder="Search members by name or ID...">
      </div>

      <!-- Table container -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Position</th>
              <th>Region</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="membersBody"></tbody>
        </table>
      </div>
    </main>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async ()=>{

const supabase = window.supabase.createClient(
  "https://pqrsljahrnjgkadflbmr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
);

const body = document.getElementById("membersBody");
const search = document.getElementById("search");
const modal = document.getElementById("modal");

let members = [];
const { data } = await supabase.from("members").select("*");
members = data || [];
render(members);
updateStats(members);

function badge(status) {
  const statusClass = status ? status.toLowerCase() : 'inactive';
  return `<span class="badge ${statusClass}">${status || 'Inactive'}</span>`;
}

function updateStats(membersList) {
  const total = membersList.length;
  const active = membersList.filter(m => m.status && m.status.toLowerCase() === 'active').length;
  const suspended = membersList.filter(m => m.status && m.status.toLowerCase() === 'suspended').length;
  const inactive = membersList.filter(m => !m.status || m.status.toLowerCase() === 'inactive').length;
  
  document.getElementById('statTotal').textContent = total;
  document.getElementById('statActive').textContent = active;
  document.getElementById('statSuspended').textContent = suspended;
  document.getElementById('statInactive').textContent = inactive;
}

function render(list) {
  body.innerHTML = list.map(m => `
    <tr data-id="${m.member_id}">
      <td>${m.member_id}</td>
      <td>${m.full_name}</td>
      <td>${m.position || '-'}</td>
      <td>${m.region || '-'}</td>
      <td>${badge(m.status)}</td>
    </tr>
  `).join("");

  document.querySelectorAll("tbody tr").forEach(row => {
    row.addEventListener("click", () => {
      const member = members.find(m => m.member_id === row.dataset.id);
      openProfile(member);
    });
  });
}

search.oninput = e => {
  const q = e.target.value.toLowerCase();
  const filtered = members.filter(m =>
    (m.full_name && m.full_name.toLowerCase().includes(q)) ||
    (m.member_id && m.member_id.toLowerCase().includes(q))
  );
  render(filtered);
  updateStats(filtered);
};

async function openProfile(member) {
  const { data: assistants } = await supabase
    .from("assistants")
    .select("*")
    .eq("parent_member_id", member.member_id);

  modal.style.display = "flex";

  modal.innerHTML = `
  <div class="profile-box">
    <div class="close-btn" id="closeModal">
      <i class="fas fa-times"></i>
    </div>

    <div class="profile-header">
      <h2>OFFICIAL PERSONNEL RECORD</h2>
    </div>

    <div class="profile-body">
      <div class="profile-top">
        <div class="profile-photo">
          ${member.photo_url 
            ? `<img src="${member.photo_url}" alt="${member.full_name}">` 
            : `<i class="fas fa-user-circle fa-5x"></i>`}
        </div>

        <div class="profile-summary">
          <h3>${member.full_name}</h3>
          <div class="summary-row"><strong>Member ID:</strong> ${member.member_id}</div>
          <div class="summary-row"><strong>Position:</strong> ${member.position || '-'}</div>
          <div class="summary-row"><strong>Status:</strong> ${member.status || 'Inactive'}</div>
          <div class="summary-row"><strong>Region:</strong> ${member.region || '-'}</div>
        </div>
      </div>

      <div class="section-title">Complete Member Information</div>

      <div class="info-grid">
        ${Object.entries(member).map(([key, value]) => `
          <div class="info-item">
            <strong>${key.replace(/_/g, " ").toUpperCase()}</strong>
            ${value !== null && value !== undefined ? value : '-'}
          </div>
        `).join("")}
      </div>

      <div class="section-title">Assigned Assistants</div>

      <div class="assistants-grid">
        ${assistants && assistants.length > 0
          ? assistants.map(a => `
            <div class="assistant-card">
              ${a.photo_url 
                ? `<img src="${a.photo_url}" alt="${a.full_name}">` 
                : `<i class="fas fa-user-circle fa-3x"></i>`}
              <strong>${a.full_name}</strong>
              <div>${a.position || 'Assistant'}</div>
            </div>
          `).join("")
          : `<div style="grid-column: 1/-1; text-align: center; padding: 30px; color: #7f8c8d;">
               <i class="fas fa-user-plus fa-2x" style="margin-bottom: 10px;"></i>
               <p>No assistants assigned</p>
             </div>`
        }
      </div>
    </div>
  </div>`;

  document.getElementById("closeModal").onclick = () => {
    modal.style.display = "none";
  };
}

modal.onclick = e => {
  if (e.target === modal) modal.style.display = "none";
};

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    modal.style.display = "none";
  }
});

});
</script>
</body>
</html>