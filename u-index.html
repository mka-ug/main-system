<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Umoomi Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Segoe UI,sans-serif;background:#f2f2f2;padding:20px}
.container{max-width:1400px;margin:auto}

/* HEADER */
header{
  background:#ccdc;padding:20px;border-radius:10px;
  display:flex;gap:15px;align-items:center;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  margin-bottom:20px
}
header i{font-size:2.5rem;color:#2c3e50}

/* LAYOUT */
.layout{display:grid;grid-template-columns:240px 1fr;gap:20px}

/* SIDEBAR */
aside{
  background:#fff;border-radius:10px;padding:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  height:calc(100vh - 160px)
}
aside a{
  display:block;text-decoration:none;
  padding:12px 15px;border-radius:6px;
  color:#2c3e50;margin-bottom:6px;font-size:1rem
}
aside a i{width:22px;margin-right:10px}
aside a:hover,aside a.active{
  background:#3498db;color:#fff
}

/* MAIN */
main{
  background:#fff;border-radius:10px;padding:20px;
  box-shadow:0 4px 6px rgba(0,0,0,.1)
}

/* QUICK ACTIONS */
.quick-actions{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:12px;margin-bottom:20px
}
.quick-actions button{
  padding:14px;border:none;border-radius:10px;
  cursor:pointer;font-weight:600;
  display:flex;align-items:center;justify-content:center;gap:8px
}
.qa-msg{background:#e8f4fd}
.qa-rem{background:#fff3cd}
.qa-evt{background:#e9f7ef}
.qa-rep{background:#f5eef8}

/* STATS */
.stats{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:15px;margin-bottom:20px
}
.stat{
  background:linear-gradient(135deg,#2c3e50,#3498db);
  color:#fff;padding:18px;border-radius:10px;text-align:center
}
.stat i{font-size:2rem;margin-bottom:6px}
.stat .number{font-size:1.8rem;font-weight:bold}

/* CHARTS */
.charts{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.chart-box{background:#f8f9fa;border-radius:10px;padding:15px}
.chart-box h4{text-align:center;margin-bottom:10px}

/* MODALS */
.modal-backdrop{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.5);z-index:999
}
.modal{
  display:none;position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff;padding:20px;border-radius:10px;
  width:380px;z-index:1000
}
.modal input,.modal textarea,.modal select{
  width:100%;padding:10px;margin-bottom:10px;
  border:1px solid #ccc;border-radius:6px
}
.modal button{
  width:100%;padding:10px;border:none;
  background:#3498db;color:#fff;border-radius:6px;cursor:pointer
}
</style>
</head>

<body>
<div class="container">

<header>
  <i class="fas fa-shield-alt"></i>
  <div>
    <h2>Umoomi Security System</h2>
    <small>Ahmadiyya Muslim Community Uganda</small>
  </div>
</header>

<div class="layout">

<aside>
  <a href="index.html" class="active"><i class="fas fa-users"></i> Dashboard</a>
  <a href="members.html"><i class="fas fa-chart-line"></i> Members</a>
  <a href="scanner.html"><i class="fas fa-qrcode"></i> Scan ID</a>
  <a href="regions.html"><i class="fas fa-map-marker-alt"></i> Regions</a>
  <a href="scan-logs.html"><i class="fas fa-history"></i> Activity Logs</a>
  <a href="admin.html"><i class="fas fa-user-shield"></i> Admin Panel</a>
  <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
</aside>

<main>

<div class="quick-actions">
  <button class="qa-msg" id="btnMsg"><i class="fas fa-envelope"></i> Messages</button>
  <button class="qa-rem" id="btnRem"><i class="fas fa-bell"></i> Reminders</button>
  <button class="qa-evt" id="btnEvt"><i class="fas fa-calendar"></i> Events</button>
  <button class="qa-rep" id="btnRep"><i class="fas fa-file-alt"></i> Reports</button>
</div>

<div class="stats">
  <div class="stat"><i class="fas fa-users"></i><div>Total Members</div><div id="totalMembers" class="number">0</div></div>
  <div class="stat"><i class="fas fa-user-check"></i><div>Active Members</div><div id="activeMembers" class="number">0</div></div>
  <div class="stat"><i class="fas fa-map-marker-alt"></i><div>Total Regions</div><div id="regionsCount" class="number">0</div></div>
  <div class="stat"><i class="fas fa-clock"></i><div>Last Scan</div><div id="lastScan" class="number">-</div></div>
</div>

<div class="charts">
  <div class="chart-box"><h4>Members per Region</h4><canvas id="membersRegionChart"></canvas></div>
  <div class="chart-box"><h4>Most Active Regions</h4><canvas id="activeRegionChart"></canvas></div>
  <div class="chart-box"><h4>Scan Trend</h4><canvas id="scanTrendChart"></canvas></div>
</div>

</main>
</div>
</div>

<!-- MODALS -->
<div id="backdrop" class="modal-backdrop"></div>

<div id="msgModal" class="modal">
  <h3>Send Message</h3>
  <input placeholder="Title">
  <select><option>All Members</option><option>By Region</option></select>
  <textarea placeholder="Message content"></textarea>
  <button onclick="closeModals()">Send</button>
</div>

<div id="remModal" class="modal">
  <h3>Create Reminder</h3>
  <input placeholder="Reminder title">
  <input type="datetime-local">
  <textarea placeholder="Notes"></textarea>
  <button onclick="closeModals()">Save</button>
</div>

<div id="evtModal" class="modal">
  <h3>Create Event</h3>
  <input placeholder="Event name">
  <input type="date">
  <input placeholder="Location">
  <textarea placeholder="Description"></textarea>
  <button onclick="closeModals()">Create</button>
</div>

<div id="repModal" class="modal">
  <h3>Generate Report</h3>
  <select>
    <option>Members</option>
    <option>Scans</option>
    <option>Regions</option>
  </select>
  <button onclick="closeModals()">Generate</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", async ()=>{

  const supabase = window.supabase.createClient(
    "https://pqrsljahrnjgkadflbmr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
  );

  const { data: members=[] } = await supabase.from("umoomi_members").select("*");
  const { data: scans=[] } = await supabase.from("scan_logs").select("*");

  totalMembers.textContent = members.length;
  activeMembers.textContent = members.filter(m=>m.status==="Active").length;
  regionsCount.textContent = new Set(members.map(m=>m.region)).size;
  if(scans.length) lastScan.textContent=new Date(scans[0].created_at).toLocaleString();

  const regionMap={};
  members.forEach(m=>regionMap[m.region]=(regionMap[m.region]||0)+1);

  new Chart(membersRegionChart,{
    type:"bar",
    data:{labels:Object.keys(regionMap),datasets:[{data:Object.values(regionMap)}]}
  });

  const scanMap={};
  scans.forEach(s=>scanMap[s.region]=(scanMap[s.region]||0)+1);

  new Chart(activeRegionChart,{
    type:"doughnut",
    data:{labels:Object.keys(scanMap),datasets:[{data:Object.values(scanMap)}]}
  });

  const trend={};
  scans.forEach(s=>{
    const d=new Date(s.created_at).toLocaleDateString();
    trend[d]=(trend[d]||0)+1;
  });

  new Chart(scanTrendChart,{
    type:"line",
    data:{labels:Object.keys(trend),datasets:[{data:Object.values(trend),tension:.4}]}
  });

  // BUTTON HANDLERS
  btnMsg.onclick=()=>openModal(msgModal);
  btnRem.onclick=()=>openModal(remModal);
  btnEvt.onclick=()=>openModal(evtModal);
  btnRep.onclick=()=>openModal(repModal);
});

function openModal(m){
  backdrop.style.display="block";
  m.style.display="block";
}
function closeModals(){
  backdrop.style.display="none";
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}
backdrop.onclick=closeModals;
</script>

</body>
</html>